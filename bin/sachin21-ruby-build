#!/usr/bin/env sh
set -e

# check os
echo "If you using mac then enter m/M"
  read flag

# setup tools
if [ $flag = 'm' -o $flag = 'M' ]; then
  export RUBY_CONFIGURE_OPTS=" \
    --enable-shared \
    --with-readline-dir=$(brew --prefix readline)
    --with-openssl-dir=$(brew --prefix openssl)
    "
fi

export MAKE_OPTS="-j4"

for TARGET_VERSION in $@; do
  if rbenv install $TARGET_VERSION && rbenv global $TARGET_VERSION; then
    export RBENV_VERSION=$TARGET_VERSION

    gem install bundler
    gem install pry
    gem install pry-doc
    gem install pry-byebug
    gem install awesome_print
    gem install space2underscore
    gem install space2dot
    gem install tw
    gem install tmuxinator

    gem install rails -v '4.1.4'

    rbenv rehash

    echo "All done"
  else
    echo "[Warning] $TARGET_VERSION is install unsuccessfully" 1>&2
  fi
done

#!/usr/bin/env sh

set -e

export MAKE_OPTS="-j4"
OS=`uname`

for TARGET_VERSION in $@; do
  if [ $OS = 'Darwin' ]; then
    command="CONFIGURE_OPTS='--with-readline-dir=/usr/local --with-openssl-dir=$(brew --prefix openssl)' RUBY_CONFIGURE_OPTS='--with-openssl-dir=$(brew --prefix openssl)' rbenv install $TARGET_VERSION"
  else
    command="rbenv install $TARGET_VERSION"
  fi

  if eval $command && rbenv global $TARGET_VERSION; then
    export RBENV_VERSION=$TARGET_VERSION

    gem install bundler
    gem install pry
    gem install pry-doc
    gem install pry-byebug
    gem install awesome_print
    gem install space2underscore
    gem install space2dot
    gem install tw
    gem install tmuxinator

    gem install rails -v '4.1.4'

    rbenv rehash

    echo "All done"
  else
    echo "[Error] $TARGET_VERSION is install unsuccessfully"
  fi
done
